from unittest import TestCase
from utils import transform_polygons_to_multipolygon


class TestCambridgeImport(TestCase):
    def test_transform_polygons_to_multipolygon(self):
        polygons = [
            {
                'status': 'A',
                'geom': {
                    'type': 'Polygon',
                    'coordinates': [
                        [
                            [0.8607692231732531, 52.95391007095734],
                            [0.8607667846123711, 52.95391891517057],
                            [0.8607808527669906, 52.95392068053286],
                            [0.8607828780533133, 52.95392091051436],
                            [0.8608906009538577, 52.95393438515803],
                            [0.860895737887817, 52.95393506174295],
                            [0.8608978981549936, 52.953935306455904],
                            [0.8609030196302843, 52.95393597442056],
                            [0.8610147961438583, 52.953949953799345],
                            [0.8610197059411531, 52.95395057290395],
                            [0.8610201412052314, 52.95395062536567],
                            [0.8610225791228053, 52.95394177216994],
                            [0.8607920691451988, 52.95391285684689],
                            [0.8607879115470413, 52.953912354500424],
                            [0.8607692231732531, 52.95391007095734]
                        ]
                    ]
                },
                'id': 1234,
                'insert': '2004-11-08T00:00:00',
                'update': '2004-11-09T00:00:00'
            },
            {
                'status': 'A',
                'geom': {
                    'type': 'Polygon',
                    'coordinates': [
                        [
                            [0.8607692231732531, 52.95391007095734],
                            [0.8607667846123711, 52.95391891517057],
                            [0.8607808527669906, 52.95392068053286],
                            [0.8607828780533133, 52.95392091051436],
                            [0.8608906009538577, 52.95393438515803],
                            [0.860895737887817, 52.95393506174295],
                            [0.8608978981549936, 52.953935306455904],
                            [0.8609030196302843, 52.95393597442056],
                            [0.8610147961438583, 52.953949953799345],
                            [0.8610197059411531, 52.95395057290395],
                            [0.8610201412052314, 52.95395062536567],
                            [0.8610225791228053, 52.95394177216994],
                            [0.8607920691451988, 52.95391285684689],
                            [0.8607879115470413, 52.953912354500424],
                            [0.8607692231732531, 52.95391007095734]
                        ]
                    ]
                },
                'id': 1235,
                'insert': '2004-11-08T00:00:00',
                'update': '2004-11-09T00:00:00'
            },
            {
                'status': 'A',
                'geom': {
                    'type': 'Polygon',
                    'coordinates': [
                        [
                            [0.8607692231732531, 52.95391007095734],
                            [0.8607667846123711, 52.95391891517057],
                            [0.8607808527669906, 52.95392068053286],
                            [0.8607828780533133, 52.95392091051436],
                            [0.8608906009538577, 52.95393438515803],
                            [0.860895737887817, 52.95393506174295],
                            [0.8608978981549936, 52.953935306455904],
                            [0.8609030196302843, 52.95393597442056],
                            [0.8610147961438583, 52.953949953799345],
                            [0.8610197059411531, 52.95395057290395],
                            [0.8610201412052314, 52.95395062536567],
                            [0.8610225791228053, 52.95394177216994],
                            [0.8607920691451988, 52.95391285684689],
                            [0.8607879115470413, 52.953912354500424],
                            [0.8607692231732531, 52.95391007095734]
                        ]
                    ]
                },
                'id': 1236,
                'insert': '2004-11-08T00:00:00',
                'update': '2004-11-09T00:00:00'
            }
        ]

        mulipolygon_geo_json = transform_polygons_to_multipolygon(polygons)

        self.assertEqual(mulipolygon_geo_json['type'], 'MultiPolygon')
        self.assertEqual(len(mulipolygon_geo_json['coordinates'][0]), 3)
